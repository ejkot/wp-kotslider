<script type='text/javascript'>
	jQuery(document).ready(function($){
		$(".open-media").on("click",function(e) {
				var my=$(this);
				var send_attachment_bkp = wp.media.editor.send.attachment;
				wp.media.editor.send.attachment = function(props, attachment) {
				$(my).find("img").attr("src",attachment.url);
				$(my).find("input").attr("value",attachment.url);
				//console.log(attachment.url);
				wp.media.editor.send.attachment=send_attachment_bkp;
				}
				button=$(this);
				wp.media.editor.open(button);
				$('.media-modal-close, .media-modal-backdrop').one('click', function(){
						wp.media.editor.send.attachment=send_attachment_bkp;
						});
				return false;
				});
	});
</script>
<div class="wrap">
	<h2>Edit slider: <a href="?page=kotslider" class="add-new-h2">Back</a></h2>
	<div class="kotslider-frame">
		<div class="kotslider-frame-body">
		<form action="?page=kotslider&action=save" method="post">
			<div class="kotslider-formin">
			<h3><?php echo $vars['slider']['title']; if ($message) echo ' <strong style="color:#00FF00;">['.$message.']</strong>';?></h3>			
			<div class="kotslider-formin-wrap">
			<input type="text" name="slider_name" size="50" value="<?php echo $vars['slider']['title']; ?>" id="slider_name" class="big-text"><br>
			<label>Width:</label><input type="text" name="width" class="small-text right" value="<?php echo $vars['slider']['width']; ?>"/>
			<label>Height:</label><input type="text" name="height" class="small-text right" value="<?php echo $vars['slider']['height']; ?>"/><br />
			<input type="hidden" name="sliderid" value="<?php echo $vars['slider']['id']; ?>">
			<!--
			<label>Style:</label>
				<input type="radio" value="styledayfoto" name="sliderstyle" checked>dayphoto
				<input type="radio" value="styleselect" name="sliderstyle">select
				-->
			<hr>
			<input name="save" type="submit" class="kotslider-button bbutton" id="publish" value="Save">
			<a href="?page=kotslider&action=deleteslider&id=<?php echo $vars['slider']['id'];  ?>" class="kotslider-button gbutton" id="delete">Delete</a>
			</div>
			</div>
		
		
		<div id="slides">
<?php if (!empty($vars['slides'])) { 
				foreach ($vars['slides'] as $s) {
?>
			<div class="kotslider-formin">
				<h3><?php echo "#".$s['id']; ?></h3>
				<div class="kotslider-formin-wrap">
					<div class="kotslider-formin-slide">
						<div class="kotslider-formin-image">
						<a href="#" class="open-media" id="i<?php echo $s['id']; ?>">
							<img src="<?php echo $s['img']; ?>" class="addimage"/>
							<input type="hidden" name="i<?php echo $s['id']; ?>" value="<?php echo $s['img']; ?>"/>
						</a>
						</div>
						<div class="kotslider-formin-editor">
						<?php wp_editor($s['content'],$s['id'],Array('textarea_name'=>'t'.$s['id'],'textarea_rows' => 10)); ?>
						</div>
						</div>
						<div class="clear"></div>
				<hr>
				<a href="?page=kotslider&action=deleteslide&id=<?php echo $s['id']; ?>&sliderid=<?php echo $vars['slider']['id'];  ?>" class="kotslider-button gbutton" id="delete">Trash</a>
				</div>
			</div>
<?php 		}
			}
	?>
	</form>
		</div>
		<hr>
		<a href="?page=kotslider&action=addslide&sliderid=<?php echo $vars['slider']['id']; ?>" class="kotslider-button bbutton" method="post">+ Slide</a>
		</div>
		<?php /*
		<div class="kotslider-frame-aside">
			<div class="kotslider-setwin">
			<form action="?" name="slider-settings">
			<h3>Settings:<input name="save" type="submit" class="button button-primary button-large right" id="publish" accesskey="p" value="Save"></h3>
			<label>Width:</label><input type="text" name="width" class="small-text right" value="950"/><br />
			<label>Height:</label><input type="text" name="height" class="small-text right" value="650"/><br /><br />
			<label>Style:</label>
			<input type="radio" value="styledayfoto" name="sliderstyle" checked>dayphoto<br/>
			<label>&nbsp;</label> <input type="radio" value="styleselect" name="sliderstyle">select
			</form>
			</div>
			<div class="kotslider-setwin">
			<h3>Info:</h3>
			</div>
		</div>
		*/ ?>
	</div>
</div>